# Документация по виджету форм

## Обзор

Виджет форм - это мощный и гибкий инструмент для создания интерактивных форм на сайтах организаций. Он позволяет создавать формы с различными типами полей, настраивать их внешний вид и поведение, а также обрабатывать отправленные данные через различные экшены.

## Возможности

### Типы полей

- **Текст** - обычные текстовые поля
- **Email** - поля для email адресов с валидацией
- **Телефон** - поля для телефонных номеров
- **Текстовая область** - многострочные текстовые поля
- **Выбор** - выпадающие списки
- **Радио кнопки** - выбор одного варианта из нескольких
- **Чекбоксы** - множественный выбор
- **Файл** - загрузка файлов
- **Изображение** - загрузка изображений
- **Число** - числовые поля
- **Дата** - поля для выбора даты
- **URL** - поля для веб-адресов
- **Скрытое поле** - скрытые поля для передачи данных
- **Заголовок** - заголовки для группировки полей
- **Описание** - описательный текст

### Настройки полей

- Название и лейбл поля
- Подсказка (placeholder)
- Текст помощи
- Обязательность поля
- Валидация (правила проверки)
- Стилизация (цвета, размеры, отступы)
- Опции для полей выбора

### Экшены (обработка данных)

- **Email** - отправка данных на email
- **Webhook** - отправка данных на внешний URL
- **Database** - сохранение в базу данных
- **Telegram** - отправка уведомлений в Telegram
- **Custom** - кастомные PHP экшены

### Стилизация

- Настройка внешнего вида контейнера формы
- Стилизация полей ввода
- Настройка кнопки отправки
- Цветовая схема
- Размеры и отступы

## Использование

### 1. Добавление виджета на сайт

1. Откройте конструктор сайта
2. Перетащите виджет "Форма" на нужную позицию
3. Настройте виджет через модальное окно

### 2. Конструктор формы

Вкладка "Конструктор" позволяет:

- Добавлять поля различных типов
- Редактировать настройки полей
- Переупорядочивать поля
- Удалять ненужные поля

### 3. Предпросмотр

Вкладка "Предпросмотр" показывает, как форма будет выглядеть для пользователей.

### 4. Настройки

Вкладка "Настройки" содержит:

- Общие настройки формы (заголовок, описание)
- Настройки кнопки отправки
- Сообщения об успехе/ошибке
- Настройки редиректа
- Настройки отображения

### 5. Экшены

Вкладка "Экшены" позволяет настроить обработку отправленных данных:

- Добавить экшены
- Настроить параметры экшенов
- Создать кастомные PHP экшены

## API

### Создание формы

```http
POST /api/sites/{siteId}/forms
Content-Type: application/json

{
  "name": "Контактная форма",
  "description": "Форма для связи с нами",
  "settings": {
    "title": "Свяжитесь с нами",
    "submit_button_text": "Отправить сообщение"
  }
}
```

### Отправка формы

```http
POST /api/sites/{siteId}/forms/{widgetId}/submit
Content-Type: application/json

{
  "field_name": "value",
  "email": "user@example.com"
}
```

### Получение отправок

```http
GET /api/sites/{siteId}/forms/{widgetId}/submissions
```

## Структура базы данных

### Таблица form_widgets

- `id` - уникальный идентификатор
- `site_id` - ID сайта
- `name` - название формы
- `slug` - уникальный слаг
- `description` - описание формы
- `settings` - настройки формы (JSON)
- `styling` - стилизация (JSON)
- `actions` - экшены (JSON)
- `is_active` - активность формы
- `sort_order` - порядок сортировки

### Таблица form_fields

- `id` - уникальный идентификатор
- `form_widget_id` - ID формы
- `name` - имя поля
- `label` - лейбл поля
- `type` - тип поля
- `placeholder` - подсказка
- `help_text` - текст помощи
- `options` - опции для полей выбора (JSON)
- `validation` - правила валидации (JSON)
- `styling` - стилизация поля (JSON)
- `is_required` - обязательность
- `is_active` - активность
- `sort_order` - порядок сортировки

### Таблица form_submissions

- `id` - уникальный идентификатор
- `form_widget_id` - ID формы
- `data` - данные формы (JSON)
- `ip_address` - IP адрес отправителя
- `user_agent` - User Agent
- `referer` - источник перехода
- `status` - статус обработки
- `error_message` - сообщение об ошибке
- `actions_log` - лог выполнения экшенов (JSON)

### Таблица form_actions

- `id` - уникальный идентификатор
- `form_widget_id` - ID формы
- `name` - название экшена
- `type` - тип экшена
- `config` - конфигурация экшена (JSON)
- `is_active` - активность
- `sort_order` - порядок сортировки

## Примеры использования

### Простая контактная форма

```json
{
    "name": "Контактная форма",
    "settings": {
        "title": "Свяжитесь с нами",
        "submit_button_text": "Отправить"
    },
    "fields": [
        {
            "name": "name",
            "label": "Ваше имя",
            "type": "text",
            "is_required": true
        },
        {
            "name": "email",
            "label": "Email",
            "type": "email",
            "is_required": true
        },
        {
            "name": "message",
            "label": "Сообщение",
            "type": "textarea",
            "is_required": true
        }
    ],
    "actions": [
        {
            "type": "email",
            "config": {
                "to": ["admin@example.com"],
                "subject": "Новое сообщение с сайта"
            }
        }
    ]
}
```

### Форма регистрации на событие

```json
{
    "name": "Регистрация на событие",
    "settings": {
        "title": "Зарегистрируйтесь на наше событие",
        "success_message": "Регистрация прошла успешно!"
    },
    "fields": [
        {
            "name": "full_name",
            "label": "ФИО",
            "type": "text",
            "is_required": true
        },
        {
            "name": "email",
            "label": "Email",
            "type": "email",
            "is_required": true
        },
        {
            "name": "phone",
            "label": "Телефон",
            "type": "phone",
            "is_required": true
        },
        {
            "name": "event_type",
            "label": "Тип участия",
            "type": "radio",
            "options": [
                { "value": "speaker", "label": "Докладчик" },
                { "value": "participant", "label": "Участник" },
                { "value": "volunteer", "label": "Волонтер" }
            ],
            "is_required": true
        }
    ]
}
```

## Расширение функциональности

### Создание кастомного экшена

1. Создайте PHP класс в `app/Http/Controllers/FormActions/`
2. Реализуйте метод `execute(FormSubmission $submission): bool`
3. Зарегистрируйте экшен в настройках формы

```php
<?php

namespace App\Http\Controllers\FormActions;

use App\Models\FormSubmission;

class CustomNotificationAction
{
    public function execute(FormSubmission $submission): bool
    {
        // Ваша логика обработки
        return true;
    }
}
```

## Безопасность

- Все данные форм валидируются на сервере
- Поддерживается CSRF защита
- Ограничения на размер загружаемых файлов
- Санитизация пользовательского ввода
- Логирование всех действий

## Производительность

- Оптимизированные SQL запросы
- Кэширование настроек форм
- Асинхронная обработка экшенов
- Минимизация JavaScript кода
- Сжатие CSS стилей
