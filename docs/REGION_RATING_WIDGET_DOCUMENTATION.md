# Виджет рейтинга регионов

## Описание

Виджет для отображения рейтинга регионов по количеству и сумме пожертвований для конкретной организации. Показывает статистику по регионам с возможностью сортировки, поиска и пагинации.

## Возможности

### Основные функции

- Отображение списка регионов с суммой пожертвований
- Показ количества пожертвований по каждому региону
- Индикаторы изменений (рост/снижение за период)
- Поиск по названию региона
- Сортировка по сумме, количеству или названию
- Пагинация результатов

### Настройки виджета

- **Заголовок и подзаголовок** - настраиваемые тексты
- **Количество на странице** - от 5 до 50 элементов
- **Макет отображения**:
    - Список - вертикальный список
    - Сетка - карточки в несколько колонок
    - Компактный - минималистичный вид
- **Стиль карточек**:
    - Стандартный - базовый дизайн
    - Современный - с тенями
    - Минималистичный - без рамок
- **Опции отображения**:
    - Показывать количество регионов
    - Показывать количество пожертвований
    - Показывать индикаторы изменений
    - Показывать флаги регионов (в будущем)
    - Показывать поиск
    - Показывать фильтры
    - Показывать пагинацию

## Использование

### Добавление виджета

1. В редакторе сайта выберите позицию для виджета
2. Нажмите "Добавить виджет"
3. Выберите "Виджет рейтинга регионов"
4. Настройте параметры отображения
5. Сохраните изменения

### API Endpoints

#### Получение рейтинга регионов

```
GET /api/organizations/{organization}/region-rating
```

Параметры запроса:

- `page` - номер страницы (по умолчанию: 1)
- `per_page` - количество элементов на странице (по умолчанию: 10)
- `search` - поисковый запрос по названию региона
- `sort_by` - поле сортировки (`amount`, `count`, `name`)
- `sort_order` - порядок сортировки (`asc`, `desc`)

#### Получение статистики

```
GET /api/organizations/{organization}/region-rating/stats
```

## Структура данных

### Регион

```json
{
    "id": 1,
    "name": "Москва",
    "code": "77",
    "flag_image": null,
    "total_amount": 2493221,
    "donation_count": 127,
    "change_amount": 27,
    "change_count": 3,
    "region_url": null
}
```

### Ответ API

```json
{
    "success": true,
    "data": [
        {
            "id": 1,
            "name": "Москва",
            "code": "77",
            "flag_image": null,
            "total_amount": 2493221,
            "donation_count": 127,
            "change_amount": 27,
            "change_count": 3,
            "region_url": null
        }
    ],
    "pagination": {
        "current_page": 1,
        "last_page": 3,
        "per_page": 10,
        "total": 25
    }
}
```

## Технические детали

### Зависимости

- Таблица `regions` - справочник регионов
- Таблица `donations` - пожертвования с полем `region_id`
- Модели: `Region`, `Donation`, `Organization`

### Миграции

- `add_region_id_to_donations_table` - добавляет поле `region_id` в таблицу пожертвований

### Компоненты

- `RegionRatingWidget.tsx` - основной компонент виджета
- `region-rating.scss` - стили виджета
- `RegionRatingController.php` - API контроллер

## Будущие улучшения

1. **Флаги регионов** - добавление изображений флагов/гербов регионов
2. **Ссылки на регионы** - возможность перехода на страницы регионов
3. **Дополнительная статистика** - средняя сумма пожертвования, тренды
4. **Экспорт данных** - возможность экспорта рейтинга в различные форматы
5. **Фильтрация по периоду** - возможность выбора временного диапазона
6. **Карта регионов** - визуализация данных на карте

## Устранение неполадок

### Виджет не отображает данные

1. Проверьте, что в таблице `donations` есть поле `region_id`
2. Убедитесь, что пожертвования связаны с регионами
3. Проверьте права доступа к API

### Ошибки стилизации

1. Убедитесь, что файл `region-rating.scss` подключен в `app.scss`
2. Проверьте корректность CSS классов Tailwind

### Проблемы с API

1. Проверьте маршруты в `routes/api.php`
2. Убедитесь, что контроллер `RegionRatingController` существует
3. Проверьте логи Laravel для деталей ошибок
